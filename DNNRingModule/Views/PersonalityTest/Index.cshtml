@inherits DotNetNuke.Web.Mvc.Framework.DnnWebViewPage
@using DotNetNuke.Web.Client.ClientResourceManagement
@using DotNetNuke.Framework.JavaScriptLibraries
@using DotNetNuke.Entities.Users
@using System.Text.RegularExpressions
@using DotNetNuke.Web.Mvc.Helpers

@{
    int step = ViewBag.Step ?? 0;
    var user = ViewBag.User as UserInfo;
    bool isLoggedIn = ViewBag.IsLoggedIn ?? false;
}

@if (!isLoggedIn)
{
    <p>⚠️ A teszt kitöltéséhez be kell jelentkezned.</p>
    <button id="customLoginTrigger" class="btn btn-primary btn-lg">Bejelentkezek</button>
}
else if (step == 0)
{
    <h2>💍 Fedezd fel a hozzád illő gyűrűt!</h2>
    <p>Kedves @user.DisplayName, válaszolj néhány kérdésre, és mi ajánlunk neked egy tökéletes gyűrűt.</p>

    @*<a href="@Url.Action("Index", new { step = 1 })" class="btn btn-primary btn-lg">Kezdjünk!</a>*@
    <form method="post" action="@Url.Action("Index", "PersonalityTest")">
        <input type="hidden" name="step" value="0" />
        <button type="submit" class="btn btn-primary btn-lg">Kezdjünk!</button>
    </form>
}
else
{
    <h2>Személyiségteszt</h2>
    <form method="post" action="@Url.Action("Index", "PersonalityTest")">
        <input type="hidden" name="step" value="@step" />

        @if (step == 1)
        {
            <p>1. Mi alapján választod meg az öltözködésedet?</p>
            <label><input type="radio" name="q1" value="A" /> A) Legyen karakteres és tükrözze, hogy céltudatos vagyok</label><br />
            <label><input type="radio" name="q1" value="B" /> B) Letisztult, modern stílust keresek</label><br />
            <label><input type="radio" name="q1" value="C" /> C) Fontos, hogy tükrözze az egyéniségem</label><br />
            <label><input type="radio" name="q1" value="D" /> D) Szeretem a klasszikus, időtálló eleganciát</label>

            <p>2. Mit csinálnál egy szabad hétvégén?</p>
            <label><input type="radio" name="q2" value="A" /> A) Edzenék, versenyre készülnék, vagy sporteseményt néznék</label><br />
            <label><input type="radio" name="q2" value="B" /> B) Okos kütyükkel foglalkoznék vagy DIY projekteken dolgoznék</label><br />
            <label><input type="radio" name="q2" value="C" /> C) Elmerülnék egy fantasy világban vagy filmekben</label><br />
            <label><input type="radio" name="q2" value="D" /> D) Pihenés, wellness, elegancia és kényeztetés</label>

            <p>3. Milyen ékszereket viselsz leggyakrabban?</p>
            <label><input type="radio" name="q3" value="A" /> A) Olyan darabot, ami erőt, elért sikert vagy státuszt szimbolizál</label><br />
            <label><input type="radio" name="q3" value="B" /> B) Minimalista, modern darabokat</label><br />
            <label><input type="radio" name="q3" value="C" /> C) Egyedi, különleges vagy antik hatásúakat</label><br />
            <label><input type="radio" name="q3" value="D" /> D) Arany vagy ezüst, klasszikus darabokat</label>

            <p>4. Melyik állítás illik rád legjobban?</p>
            <label><input type="radio" name="q4" value="A" /> A) Küzdök a céljaimért és szeretem a versenyt</label><br />
            <label><input type="radio" name="q4" value="B" /> B) Szeretem, ha minden okosan és logikusan működik</label><br />
            <label><input type="radio" name="q4" value="C" /> C) Hiszek a varázslatban és a különlegességekben</label><br />
            <label><input type="radio" name="q4" value="D" /> D) Szeretem a luxust és a hagyományokat</label>

            <p>5. Ha gyűrűt választanál, mit vársz tőle?</p>
            <label><input type="radio" name="q5" value="A" /> A) Képviselje az elért teljesítményemet</label><br />
            <label><input type="radio" name="q5" value="B" /> B) Legyen okos, mutasson többet mint kinézet</label><br />
            <label><input type="radio" name="q5" value="C" /> C) Legyen egyedi, akár szokatlan</label><br />
            <label><input type="radio" name="q5" value="D" /> D) Időtlen, klasszikus darab, amit évtizedekig viselek</label>
        }
        else if (step == 2)
        {
            <p>6. Milyen környezetben érzed legjobban magad?</p>
            <label><input type="radio" name="q6" value="A" /> A) Ott, ahol teljesíteni lehet – sportpályán, arénában...</label><br />
            <label><input type="radio" name="q6" value="B" /> B) Modern, high-tech környezet</label><br />
            <label><input type="radio" name="q6" value="C" /> C) Mesévilág, filmek, képzelet</label><br />
            <label><input type="radio" name="q6" value="D" /> D) Elegáns, rendezett, ízléses helyeken</label>

            <p>7. Melyik karakterrel tudsz azonosulni?</p>
            <label><input type="radio" name="q7" value="A" /> A) Egy bajnokkal, aki diadalra tör</label><br />
            <label><input type="radio" name="q7" value="B" /> B) Egy techzsenivel</label><br />
            <label><input type="radio" name="q7" value="C" /> C) Egy mágus vagy harcos a fantasy világból</label><br />
            <label><input type="radio" name="q7" value="D" /> D) Egy arisztokrata vagy stílusikon</label>

            <p>8. Mit gondolsz a divatról?</p>
            <label><input type="radio" name="q8" value="A" /> A) A megjelenésem tükrözze, hogy nem adom alább...</label><br />
            <label><input type="radio" name="q8" value="B" /> B) Praktikus és innovatív kell legyen</label><br />
            <label><input type="radio" name="q8" value="C" /> C) Önmagam kifejezése</label><br />
            <label><input type="radio" name="q8" value="D" /> D) A részletek és elegancia mindenek felett</label>

            <p>9. Milyen a munkád vagy hivatásod?</p>
            <label><input type="radio" name="q9" value="A" /> A) Dinamikus, célorientált és mindig hozni kell az eredményeket</label><br />
            <label><input type="radio" name="q9" value="B" /> B) Technológiához vagy rendszerekhez kapcsolódó</label><br />
            <label><input type="radio" name="q9" value="C" /> C) Kreatív, művészeti vagy szabad gondolkodású</label><br />
            <label><input type="radio" name="q9" value="D" /> D) Klasszikus, üzleti, elegáns közeg</label>

            <p>10. Mi fog meg egy gyűrűben először?</p>
            <label><input type="radio" name="q10" value="A" /> A) Az, ha erőt sugároz és egy életstílust képvisel</label><br />
            <label><input type="radio" name="q10" value="B" /> B) Technológiai tudás vagy különlegesség</label><br />
            <label><input type="radio" name="q10" value="C" /> C) Fantáziadús design</label><br />
            <label><input type="radio" name="q10" value="D" /> D) Fény, nemesség, elegancia</label>
        }

        <button type="submit" class="btn btn-success">
            @(step == 1 ? "Tovább" : "Teszt befejezése")
        </button>
    </form>
}

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const loginBtn = document.getElementById("customLoginTrigger");
        if (loginBtn) {
            loginBtn.addEventListener("click", function (e) {
                e.preventDefault();
                const headerLogin = document.querySelector('.LoginLink');
                if (headerLogin) {
                    headerLogin.click();
                } else {
                    alert("Kérlek használd a fenti 'Bejelentkezés' menüpontot.");
                }
            });
        }
    });
</script>